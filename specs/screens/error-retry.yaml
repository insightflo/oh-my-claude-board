version: "2.0"

screen:
  name: 에러 분석 + 재시도
  route: S-04
  layout: modal-confirm
  auth: false

data_requirements:
  - resource: tasks
    needs: [task_id, task_name, task_status]

  - resource: error_analysis
    needs: [error_message, analysis, retryable, suggestion]

components:
  - id: retry_confirm
    type: modal
    position: overlay
    function: "Task {ID}를 재시도하시겠습니까? [y/n]" 확인 프롬프트
    data_source:
      resource: tasks
    events:
      - on: key:y
        do: 재시도 실행 (TASKS.md 상태 업데이트 트리거)
      - on: key:n
        do: 확인 창 닫기, S-03으로 복귀

  - id: retry_progress
    type: detail
    position: overlay
    function: 재시도 진행 스피너 + "재시도 중..." 메시지
    events:
      - on: retry:complete
        do: 성공/실패 메시지 표시 후 S-03 복귀

connections:
  navigations:
    - from: retry_confirm
      to: S-03 태스크 상세

  shared_components: []

tests:
  - name: 재시도 확인
    when: 에러 태스크에서 r 키 입력
    then:
      - 확인 프롬프트 표시
      - y 입력 시 재시도 실행
      - n 입력 시 취소

  - name: 재시도 성공
    when: 재시도 후 태스크 성공
    then:
      - 간트차트에서 태스크 상태 InProgress → Completed
      - 상세 패널 업데이트

  - name: 재시도 가능 여부
    when: retryable=false인 에러
    then:
      - "이 에러는 재시도할 수 없습니다" 메시지 표시
      - r 키 비활성화
