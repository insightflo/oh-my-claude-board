version: "1.0"

# oh-my-claude-board는 REST API가 아닌 파일 기반 데이터 소스를 사용합니다.
# endpoints는 데이터 수집 방식(file watch, parse)으로 대체됩니다.

resources:
  # ===== Tasks (TASKS.md 기반) =====
  tasks:
    name: Tasks
    description: TASKS.md에서 파싱되는 Phase/Task 데이터

    endpoints:
      - method: WATCH
        path: file://TASKS.md
        description: notify crate로 파일 변경 감시

      - method: PARSE
        path: file://TASKS.md
        description: nom/pest로 마크다운 파싱

    fields:
      phases:
        type: array
        description: Phase 목록

      phase_id:
        type: string
        description: Phase 식별자 (예 "phase-1")

      phase_name:
        type: string
        description: Phase 이름

      phase_status:
        type: string
        description: Pending | InProgress | Completed | Failed

      phase_progress:
        type: number
        description: 완료율 0.0 ~ 1.0

      task_id:
        type: string
        description: Task 식별자 (예 "T1.1")

      task_name:
        type: string
        description: Task 이름

      task_status:
        type: string
        description: Pending | InProgress | Completed | Failed | Blocked

      task_agent:
        type: string
        required: false
        description: 할당된 에이전트 이름

      task_blocked_by:
        type: array
        required: false
        description: 의존하는 Task ID 목록

  # ===== Hook Events (JSON 파일 기반) =====
  hook_events:
    name: Hook Events
    description: Claude Code Hook이 출력하는 JSON 이벤트

    endpoints:
      - method: WATCH
        path: file://.claude/hooks/events/
        description: Hook 이벤트 디렉토리 감시

      - method: PARSE
        path: file://.claude/hooks/events/*.jsonl
        description: JSON Lines 파싱

    fields:
      event_type:
        type: string
        description: agent_start | agent_end | tool_start | tool_end | error

      timestamp:
        type: datetime
        description: 이벤트 발생 시간

      agent_id:
        type: string
        required: false
        description: 에이전트 식별자

      task_id:
        type: string
        required: false
        description: 연관 Task ID

      tool_name:
        type: string
        required: false
        description: 사용된 도구 이름

      error_message:
        type: string
        required: false
        description: 에러 메시지

      session_id:
        type: string
        required: false
        description: 세션 ID

  # ===== Error Analysis (규칙 기반 + API) =====
  error_analysis:
    name: Error Analysis
    description: 에러 분석 결과 (규칙 기반 또는 Anthropic API)

    endpoints:
      - method: ANALYZE
        path: internal://rules-engine
        description: 규칙 기반 패턴 매칭

      - method: ANALYZE
        path: https://api.anthropic.com/v1/messages
        description: Anthropic API (선택적)
        auth: true

    fields:
      error_message:
        type: string
        description: 원본 에러 메시지

      category:
        type: string
        description: Type | Runtime | Network | Permission | Unknown

      analysis:
        type: string
        description: 분석 결과 텍스트

      retryable:
        type: boolean
        description: 재시도 가능 여부

      suggestion:
        type: string
        required: false
        description: 해결 제안

  # ===== Session (인메모리) =====
  session:
    name: Session
    description: 현재 대시보드 세션 메타데이터

    endpoints:
      - method: COMPUTE
        path: internal://state
        description: 인메모리 상태에서 계산

    fields:
      tasks_md_path:
        type: string
        description: TASKS.md 파일 경로

      hooks_dir:
        type: string
        required: false
        description: Hook 이벤트 디렉토리 경로

      started_at:
        type: datetime
        description: 세션 시작 시간

      total_tasks:
        type: number
        description: 전체 태스크 수

      completed_tasks:
        type: number
        description: 완료된 태스크 수

      failed_tasks:
        type: number
        description: 실패한 태스크 수

      overall_progress:
        type: number
        description: 전체 진행률 0.0 ~ 1.0

      uptime:
        type: string
        description: 세션 경과 시간 (HH:MM:SS)
